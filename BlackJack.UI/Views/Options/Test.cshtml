@model BlackJack.ViewModels.GameViewModel

@{
    ViewBag.Title = "Test";
}


<div class="text-center">
    <h4>@Model.Dealer.Name</h4>
    <p><img src="#" alt="DealerIcon" /></p>
    <p id="DealerScore">@Model.Dealer.Score</p>

</div>


<div class="field">

</div>

<div class="container text-center">
    <div class="text-center col-md-2">
        <p id="PlayerScore">@Model.Player.Score</p>
        <p><img src="#" alt="PlayerIcon" /></p>
        <h4>@Model.Player.Name</h4>
    </div>
    @foreach (var a in Model.Bots)
    {
        <div class="text-center col-md-2">
            <p class="Bot">@a.Score</p>
            <p><img src="#" alt="BotIcon" /></p>
            <h4>@a.Name</h4>
        </div>
    }

</div>


<div class="ControlBar text-right">
    <button id="Deal">Deal the cards</button>
    <button id="Take">Take</button>
    <button id="Stop">Stop</button>
</div>


<script>
    function getRandomInt(min, max)
    {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    var CardArray = @Html.Raw(Json.Encode(Model.Cards));
    var Player = @Html.Raw(Json.Encode(Model.Player));
    var Dealer = @Html.Raw(Json.Encode(Model.Dealer));
    var BotArray = @Html.Raw(Json.Encode(Model.Bots));


    $(function() {
        $('#Deal').on('click', function () {

            var NumCard = getRandomInt(0, 51);
            var NumCard2 = getRandomInt(0, 51);

            alert(CardArray[NumCard].Name + " " + CardArray[NumCard].Suit + ", " + CardArray[NumCard2].Name + " " + CardArray[NumCard2].Suit);

            Player.Score = CardArray[NumCard].Value + CardArray[NumCard2].Value
            $('#PlayerScore').html(Player.Score);
        });
    });

    $(function () {
        $('#Take').on('click', function () {
            var NumCard = getRandomInt(0, 51);

            alert(CardArray[NumCard].Name + " " + CardArray[NumCard].Suit);
            var LastScore = $('#PlayerScore').html();

            if (LastScore > 11 && CardArray[NumCard].Value == 11) {
                $('#PlayerScore').html(+LastScore + CardArray[NumCard].Value - 10);
            }
            else {
                $('#PlayerScore').html(+LastScore + CardArray[NumCard].Value);
            }
        });
    });


        $(function(){
            $('#Stop').on('click', function () {
               
                    var NumCard = getRandomInt(0, 51);
                    var NumCard2 = getRandomInt(0, 51);

                    alert(CardArray[NumCard].Name + " " + CardArray[NumCard].Suit + ", " + CardArray[NumCard2].Name + " " + CardArray[NumCard2].Suit);


                    Dealer.Score = CardArray[NumCard].Value + CardArray[NumCard2].Value
                    $('#DealerScore').html(Dealer.Score);


                    while ($('#DealerScore').html() < 16)
                    {
                        var NumCard = getRandomInt(0, 51);

                        alert(CardArray[NumCard].Name + " " + CardArray[NumCard].Suit);
                        var LastScore = $('#DealerScore').html();
                        if (LastScore > 11 && CardArray[NumCard].Value == 11)
                        {
                            $('#DealerScore').html(+LastScore + CardArray[NumCard].Value - 10);
                        }
                        else
                        {
                            $('#DealerScore').html(+LastScore + CardArray[NumCard].Value);
                        }
                    }
                
            });
        });



</script>

